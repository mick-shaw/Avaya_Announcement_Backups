# Avaya_Announcement_Backups
This is a script that allows to you establish an archive of Avaya announcement files stored across multiple Communication Manager instances, TN2501 VAL boards and integrated announcement modules embedded within the G450 Media Gateways.  This script can be scheduled to run as cron job or simply kick it off whenever you need a backup.

System Manager, while"reportedly" has the capability to backup announcements, actually isn't very useful if you want to access the recordings or archive them, and as of SMGR 6.3.17 it simply misses announcements when it backs them up!!  Avaya's VAL Manager is a very old java based application that allows you to schedule back-ups, but doesn't really let you establish an archive.  Therefore, I wrote this perl script to backup all announcements across both TN2501 Circuit packs and integrated announcements within the H.248 Media Gateways.  I hope other find it useful.

This utility script will first pull a list of all VAL boards using the "list ip-interface val" to gather the IP-address and slot location of each board.  It then uses the slot location to perform an enable file-xfer within CM and sets the username and password for the SFTP session.  Next, it transfers the files for each board using the IP-Address gathered from the "list ip-interface val" command and dumps each wav file to the defined base directory.  Within the defined base directory, a subdirectory is created for each Communication Manager Instance followed by another subdirectory for each VAL board and followed yet again by a subdirectory annotating the time of the backup.  Finally, it disables the filexfer within CM to prevent future file transfers.

Unfortunately, we can't use SFTP for the H.248 Media Gateways.  Initially, I thought Avaya must have addressed this in a later firmware release, but no.  I've tested this against the latest G450 firmware as of 05/15/16 and FTP is the only option to transfer audio files from the H.248 Media Gateways.   I will say, I have only tested this against G450 Media Gateways, so modifications will be required for H.248 gateways where the integrated announcement module is not V9.  All that said, the process is the same for the G450 media gateways.  However, we gather the ip-address of the media-gateways using the command "list media gateways."  

Note: CM instances have to be defined in the cli_ossi module before they can be referenced as $pbx variable value.The cli_ossi module included is a modified version of Ben Roy's Definity.pm which is used to interface with Communication Manager via XML Interface. https://github.com/benroy73/pbxd.
